s = Server.local;
s.boot;
Buffer.freeAll

(
~quiVeutDuCafe_caf = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/quiVeutDuCafe/caf.aif");
~quiVeutDuCafe_cafe = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/quiVeutDuCafe/cafe.aif");
~quiVeutDuCafe_du = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/quiVeutDuCafe/du.aif");
~quiVeutDuCafe_e = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/quiVeutDuCafe/e.aif");
~quiVeutDuCafe_fe = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/quiVeutDuCafe/fe.aif");
~quiVeutDuCafe_quiVeut = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/quiVeutDuCafe/quiVeut.aif");
~quiVeutDuCafe_quiVeutDu = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/quiVeutDuCafe/quiVeutDu.aif");
~quiVeutDuCafe_quiVeutDuCafe = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/quiVeutDuCafe/quiVeutDuCafe.aif");
~quiVeutDuCafe_quiVeutDuCafeFULL = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/quiVeutDuCafe/quiVeutDuCafeFULL.aif");
~quiVeutDuCafe = [
~quiVeutDuCafe_caf,
~quiVeutDuCafe_cafe,
~quiVeutDuCafe_du,
~quiVeutDuCafe_e,
~quiVeutDuCafe_fe,
~quiVeutDuCafe_quiVeut,
~quiVeutDuCafe_quiVeutDu,
~quiVeutDuCafe_quiVeutDuCafe,
];
~jenAiDeja_ai = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/jenAiDeja/ai.aif");
~jenAiDeja_ci = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/jenAiDeja/ci.aif");
~jenAiDeja_dej = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/jenAiDeja/dej.aif");
~jenAiDeja_ja = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/jenAiDeja/ja.aif");
~jenAiDeja_jen = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/jenAiDeja/jen.aif");
~jenAiDeja_jenAiDejaFULL = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/jenAiDeja/jenAiDejaFULL.aif");
~jenAiDeja_merc = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/jenAiDeja/merc.aif");
~jenAiDeja_merci = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/jenAiDeja/merci.aif");
~jenAiDeja = [
~jenAiDeja_ai,
~jenAiDeja_ci,
~jenAiDeja_dej,
~jenAiDeja_ja,
~jenAiDeja_jen,
~jenAiDeja_merc,
~jenAiDeja_merci,
];
~augmentation_augmentationFULL = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/augmentation/augmentationFULL.aif");
~augmentation_copier = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/augmentation/copier.aif");
~augmentation_recu = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/augmentation/recu.aif");
~augmentation_res = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/augmentation/res.aif");
~augmentation_sion = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/augmentation/sion.aif");
~augmentation_su = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/augmentation/su.aif");
~augmentation_tas = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/augmentation/tas.aif");
~augmentation_tass = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/augmentation/tass.aif");
~augmentation_tono = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/augmentation/tono.aif");
~augmentation = [
~augmentation_recu,
~augmentation_res,
~augmentation_sion,
~augmentation_su,
~augmentation_tas,
~augmentation_tass,
~augmentation_tono,
];
~oui_oui = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/oui/oui.aif");
~oui_ouiFULL = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/oui/ouiFULL.aif");
~oui = [
~oui_oui,
];
~conversation_av = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/av.aif");
~conversation_coher = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/coher.aif");
~conversation_con = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/con.aif");
~conversation_conversationFULL = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/conversationFULL.aif");
~conversation_dev = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/dev.aif");
~conversation_jen = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/jen.aif");
~conversation_quel = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/quel.aif");
~conversation_quelCon = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/quelCon.aif");
~conversation_quis = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/quis.aif");
~conversation_raif = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/raif.aif");
~conversation_raz = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/raz.aif");
~conversation_rente = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/rente.aif");
~conversation_sas = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/sas.aif");
~conversation_sench = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/sench.aif");
~conversation_sion = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/sion.aif");
~conversation_ve = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/conversation/ve.aif");
~conversation = [
~conversation_av,
~conversation_coher,
~conversation_con,
~conversation_dev,
~conversation_jen,
~conversation_quel,
~conversation_quelCon,
~conversation_quis,
~conversation_raif,
~conversation_raz,
~conversation_rente,
~conversation_sas,
~conversation_sench,
~conversation_sion,
~conversation_ve,
];
~caTeDit_ca = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/caTeDit/ca.aif");
~caTeDit_caTeDitFULL = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/caTeDit/caTeDitFULL.aif");
~caTeDit_dit = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/caTeDit/dit.aif");
~caTeDit_dur = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/caTeDit/dur.aif");
~caTeDit_rentre = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/caTeDit/rentre.aif");
~caTeDit_teDit = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/caTeDit/teDit.aif");
~caTeDit_tot = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/caTeDit/tot.aif");
~caTeDit_tre = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/caTeDit/tre.aif");
~caTeDit = [
~caTeDit_ca,
~caTeDit_dit,
~caTeDit_dur,
~caTeDit_rentre,
~caTeDit_teDit,
~caTeDit_tot,
~caTeDit_tre,
];
~resterTravailler_enf = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/resterTravailler/enf.aif");
~resterTravailler_fait = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/resterTravailler/fait.aif");
~resterTravailler_fer = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/resterTravailler/fer.aif");
~resterTravailler_j = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/resterTravailler/j.aif");
~resterTravailler_pref = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/resterTravailler/pref.aif");
~resterTravailler_res = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/resterTravailler/res.aif");
~resterTravailler_resterTravaillerFULL = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/resterTravailler/resterTravaillerFULL.aif");
~resterTravailler_say = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/resterTravailler/say.aif");
~resterTravailler_tra = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/resterTravailler/tra.aif");
~resterTravailler_vaille = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/resterTravailler/vaille.aif");
~resterTravailler = [
~resterTravailler_enf,
~resterTravailler_fait,
~resterTravailler_fer,
~resterTravailler_j,
~resterTravailler_pref,
~resterTravailler_res,
~resterTravailler_say,
~resterTravailler_tra,
~resterTravailler_vaille,
];
~moiAussi_moiAus = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/moiAussi/moiAus.aif");
~moiAussi_moiAussiFULL = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/moiAussi/moiAussiFULL.aif");
~moiAussi_psy = Buffer.read(s,"/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/moiAussi/psy.aif");
~moiAussi = [
~moiAussi_moiAus,
~moiAussi_psy,
];

)

(
SynthDef("boring", {|bufnum, pitch, vol, ramp|
	var snd, env;
	env = Env.new([0,vol],[ramp]);
	snd = PlayBuf.ar(2,bufnum,BufRateScale.kr(bufnum), doneAction: 2);
	Out.ar(0, snd * EnvGen.kr(env));
}).send;

SynthDef("speaking0", {|bufnum, pitch|
	var snd;
	snd = PlayBuf.ar(2,bufnum,BufRateScale.kr(bufnum), doneAction: 2);
	snd = snd + (PitchShift.ar(snd, 0.2, SinOsc.kr(100,0,0.4,pitch))*0.4);
	Out.ar(0, snd);
}).send;


SynthDef("speaking1", {|bufnum, pitch, mul = 1.0, pitch2=0.8, mul2=0.0|
	var snd;
	snd = PlayBuf.ar(2,bufnum,BufRateScale.kr(bufnum), doneAction: 2);
	snd = snd + PitchShift.ar(snd, 0.2, pitch, mul: mul) + PitchShift.ar(snd, 0.2, pitch2, mul: mul2);
	Out.ar(0, Limiter.ar(snd));
}).send;

SynthDef("speaking2", {|bufnum, freq, mul = 1.0, freq2=440|
	var snd, foo0, foo1;
	snd = PlayBuf.ar(2,bufnum,BufRateScale.kr(bufnum), doneAction: 2);
	foo0 = FreqShift.ar(snd, SinOsc.kr(0.5,0,40,freq), mul: mul);
	foo1 = Pan2.ar(
		Mix.ar(Array.fill(3,{|i|LPCAnalyzer.ar(snd,Impulse.ar(freq2 + (i*400),0,0.2), 256, 50)/2.0})),
		0);
	Out.ar(0, Limiter.ar((snd * 0.1) + foo0 + foo1));
}).send;

SynthDef("dots", {|out, bufnum, pitch|
	var snd, env;
	env = Env.new([0,1,1,0],[0.05,BufDur.kr(bufnum) - 0.1, 0.05]);
	snd = PlayBuf.ar(2,bufnum,BufRateScale.kr(bufnum),doneAction: 2);
	snd = PitchShift.ar(snd, 0.2, pitch);
	Out.ar(out, snd*EnvGen.kr(env));
}).send;

SynthDef("reverb", {|in, out, vol|
	var snd;
	snd = In.ar(in, 2);
	snd = FreeVerb.ar(snd,0.8,0.8,0.8);
	Out.ar(out, Limiter.ar(snd * vol));
}).send;
)

~allCollections.size
~full.size

(
~order = [~quiVeutDuCafe_quiVeutDuCafeFULL, ~jenAiDeja_jenAiDejaFULL, ~augmentation_augmentationFULL, ~oui_ouiFULL, ~conversation_conversationFULL, ~caTeDit_caTeDitFULL, ~resterTravailler_resterTravaillerFULL, ~moiAussi_moiAussiFULL];

~collections = [~quiVeutDuCafe, ~jenAiDeja, ~augmentation, ~oui, ~conversation, ~caTeDit, ~resterTravailler, ~moiAussi];

~waits = [5,1,1.5,3,2.5,1,1,2,10];

~allCollections = [[],~collections[0],
	~collections[0]++~collections[1],
	~collections[1],
~collections[1]++~collections[2],
~collections[2],
~collections[2]++~collections[3],
~collections[3],
	~collections[3]++~collections[4],
~collections[4],
~collections[4]++~collections[5],
~collections[5],
~collections[5]++~collections[6],
~collections[6],
~collections[6]++~collections[7],
~collections[7],
	[]];

~full = [~waits, all {: x.duration, x <- ~order }].lace(~waits.size * 2 - 1);

~fullSum = all {: ~full[0..x].sum, x <- Array.fill(~full.size, {|i| i;})};

~arrayGenFunc = {|in|
	var out = [];
	~fullSum.reverse.do({|val, i|
		if (in < val, {
			out = ~allCollections[~allCollections.size - 1 - i];
		});
	});
	out;
};

~grainRoutine =
Routine.new({
	var tnow = 0;
	var pause = 0.1;
	Synth.new("reverb", [\in, 2, \out, 0, \vol, 1.0]);
	((~full.sum / pause).floor).do({|i|
		var arrrr = ~arrayGenFunc.(tnow);
		if (arrrr.size > 0, {
			var now = arrrr[(arrrr.size - 1).rand];
			//tnow.postln;
			Synth.new("dots", [\out, 2, \bufnum, now, \pitch, 0.8 + 0.4.rand]);
		});
		pause.wait;
		tnow = tnow + pause;
	});
});


~voiceRoutine =
Routine.new({
	~full.do({|val, i|
		if(i.mod(2) == 1, {
			//Synth.new("speaking1", [\bufnum, ~order[i/2], \pitch, 1.2, \mul, 1.2, \pitch2, 0.79, \mul2, 1.8])
	Synth.new("speaking2", [\bufnum, ~order[i/2], \freq, 500, \freq2, 200]);
		});
		val.wait;
	});
});
)
Synth.new("speaking1", [\bufnum, ~order[4], \pitch, 1.2, \mul, 1.2, \pitch2, 0.79, \mul2, 1.8])
Synth.new("speaking2", [\bufnum, ~order[0], \freq, 400, \freq2, 200]);

{LPCAnalyzer.ar(PlayBuf.ar(1, ~order[4], BufRateScale.kr(~order[4]), doneAction: 2),Impulse.ar(440,0,0.2), 256, 50).dup}.play

s.prepareForRecord("/Users/mikesolomon/Documents/Compositions/overtime/dJm1k3s0l/autreBureau/voicesOfCalm.wav");
s.stopRecording; // this closes the file and deallocates the buffer recording node, etc.}
(
s.record;
//~grainRoutine.reset;
~voiceRoutine.reset;
//~grainRoutine.play;
~voiceRoutine.play;
)

(
Routine.new({
	var tnow = 0;
	var pause = 0.1;
	Synth.new("reverb", [\in, 2, \out, 0, \vol, 1.0]);
	((~full.sum / pause).floor).do({|i|
		var arrrr = ~arrayGenFunc.(tnow);
		if (arrrr.size > 0, {
			var now = arrrr[(arrrr.size - 1).rand];
			//tnow.postln;
			Synth.new("dots", [\out, 2, \bufnum, now, \pitch, 0.8 + 0.4.rand]);
		});
		pause.wait;
		tnow = tnow + pause;
	});
}).play;
)
